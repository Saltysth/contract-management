# Test profile configuration for local development
server:
  port: 11000

spring:
  cloud:
    nacos:
      server-addr: ${NACOS_SERVER:localhost:18848}
      username: ${NACOS_USERNAME:nacos}
      password: ${NACOS_PASSWORD:your-nacos-password}

      discovery:
        server-addr: ${NACOS_SERVER:localhost:18848}
        namespace: ${NACOS_NAMESPACE:public}
        group: CONTRACT_REVIEW

      config:
        namespace: ${NACOS_NAMESPACE:public}
        group: CONTRACT_REVIEW
        file-extension: yml

  # 数据库配置 - Local test environment
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/postgres?targetServerType=primary&loadBalanceHosts=false}
    username: ${DB_USERNAME:postgres}
    password: ${DB_PASSWORD:your-db-password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # Redis配置 - Local test environment
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      database: 0
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
          max-wait: -1ms

  # RabbitMQ配置 - Local test environment
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: ${RABBITMQ_VHOST:/}
    connection-timeout: 15000
    publisher-confirm-type: correlated
    publisher-returns: true
    template:
      mandatory: true
    listener:
      simple:
        acknowledge-mode: manual
        retry:
          enabled: true
          initial-interval: 1000
          max-attempts: 3
          multiplier: 2

  # Flyway配置 - Test profile
  flyway:
    enabled: true
    locations:
      - classpath:db/migration
      - classpath:db/migration/file-storage
    baseline-on-migrate: false
    validate-on-migrate: true

# 日志配置
# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      id-type: auto
      logic-delete-field: isDeleted
      logic-delete-value: true
      logic-not-delete-value: false
      update-strategy: not_null
      insert-strategy: not_null
    banner: false
  mapper-locations: classpath*:mapper/**/*.xml
  type-aliases-package: com.contract.management.infrastructure.entity
  type-handlers-package: com.contract.management.infrastructure.handler

# 应用自定义配置
contract:
  cache:
    contract-detail-ttl: 1800  # 合同详情缓存30分钟
    contract-list-ttl: 600     # 合同列表缓存10分钟
    contract-stats-ttl: 3600   # 合同统计缓存1小时
    tags-ttl: 7200             # 标签缓存2小时

# 文件下载配置
file:
  download:
    type: cos
    local:
      image-base-url: ${IMAGE_BASE_URL:https://your-image-server.com/load_image/}
    cos:
      secret-id: ${COS_SECRET_ID:your-cos-secret-id}
      secret-key: ${COS_SECRET_KEY:your-cos-secret-key}
      region: ${COS_REGION:ap-shanghai}

# Resilience4j配置
resilience4j:
  circuitbreaker:
    instances:
      reviewEngine:
        register-health-indicator: true
        sliding-window-size: 10
        minimum-number-of-calls: 5
        permitted-number-of-calls-in-half-open-state: 3
        wait-duration-in-open-state: 30s
        failure-rate-threshold: 50
        slow-call-rate-threshold: 50
        slow-call-duration-threshold: 2s
      fileStorage:
        register-health-indicator: true
        sliding-window-size: 10
        minimum-number-of-calls: 5
        permitted-number-of-calls-in-half-open-state: 3
        wait-duration-in-open-state: 30s
        failure-rate-threshold: 50
        slow-call-rate-threshold: 50
        slow-call-duration-threshold: 5s

  retry:
    instances:
      reviewEngine:
        max-attempts: 3
        wait-duration: 1s
        exponential-backoff-multiplier: 2
      fileStorage:
        max-attempts: 3
        wait-duration: 1s
        exponential-backoff-multiplier: 2

# OpenAPI文档配置
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: method
  info:
    title: Contract Management API
    description: 合同管理模块API文档
    version: 1.0.0
    contact:
      name: ContractReview Team
      email: 1432488520@qq.com